<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Embroidered Beanie</title>
    <link rel="stylesheet" href="items.css">
</head>

<body>
    <div class="container">
        <!-- Linke Spalte: Slideshow -->
        <div class="image-container">
            <h1>Embroidered Beanie</h1>

            <!-- Slideshow: Black -->
            <div class="slideshow" id="slideshow-black" style="display: block;">
                <img src="img/mütze/black/knit-beanie-black-front-67633795021ac.jpg" alt="Black Beanie - Front View"
                    class="active">
                <img src="img/mütze/black/knit-beanie-black-front-6763379502582.jpg" alt="Black Beanie - Another View">
                <div class="controls">
                    <button class="prev" onclick="changeSlide(-1)">❮ Previous</button>
                    <button class="next" onclick="changeSlide(1)">Next ❯</button>
                </div>
            </div>

            <!-- Slideshow: Dark Green -->
            <div class="slideshow" id="slideshow-darkGreen" style="display: none;">
                <img src="img/mütze/darkGreen/knit-beanie-dark-green-front-67633795026ad.jpg"
                    alt="Dark Green Beanie - Front View" class="active">
                <img src="img/mütze/darkGreen/knit-beanie-dark-green-front-67633795026fe.jpg"
                    alt="Dark Green Beanie - Another View">
                <div class="controls">
                    <button class="prev" onclick="changeSlide(-1)">❮ Previous</button>
                    <button class="next" onclick="changeSlide(1)">Next ❯</button>
                </div>
            </div>

            <!-- Slideshow: Navy -->
            <div class="slideshow" id="slideshow-navy" style="display: none;">
                <img src="img/mütze/navy/knit-beanie-navy-front-6763379502605.jpg" alt="Navy Beanie - Front View"
                    class="active">
                <img src="img/mütze/navy/knit-beanie-navy-front-676337950265d.jpg" alt="Navy Beanie - Another View">
                <div class="controls">
                    <button class="prev" onclick="changeSlide(-1)">❮ Previous</button>
                    <button class="next" onclick="changeSlide(1)">Next ❯</button>
                </div>
            </div>

            <!-- Slideshow: White -->
            <div class="slideshow" id="slideshow-white" style="display: none;">
                <img src="img/mütze/white/knit-beanie-white-front-67633795027fd.jpg" alt="White Beanie - Front View"
                    class="active">
                <img src="img/mütze/white/knit-beanie-white-front-6763379502864.jpg" alt="White Beanie - Another View">
                <div class="controls">
                    <button class="prev" onclick="changeSlide(-1)">❮ Previous</button>
                    <button class="next" onclick="changeSlide(1)">Next ❯</button>
                </div>
            </div>

            <!-- Slideshow: Gray -->
            <div class="slideshow" id="slideshow-gray" style="display: none;">
                <img src="img/gray/knit-beanie-gray-front-6763379502765.jpg" alt="Gray Beanie - Front View"
                    class="active">
                <img src="img\gray\knit-beanie-gray-front-67633795027b2.jpg" alt="Gray Beanie - Another View">
                <div class="controls">
                    <button class="prev" onclick="changeSlide(-1)">❮ Previous</button>
                    <button class="next" onclick="changeSlide(1)">Next ❯</button>
                </div>
            </div>
        </div>

        <!-- Rechte Spalte: Inhalt -->
        <div class="content-container">
            <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Laudantium earum doloribus possimus in qui
                distinctio accusantium, tempore sunt sed consequatur molestias cupiditate illo sequi commodi numquam
                porro assumenda velit ullam.</p>

            <!-- Color Selection -->
            <select name="color" id="color-select">
                <option value="black" selected>Black</option>
                <option value="darkGreen">Dark Green</option>
                <option value="navy">Navy</option>
                <option value="white">White</option>
                <option value="gray">Gray</option>
            </select>

            <p><strong style="font-size: larger;"><s>22€ </s>16,50€</strong></p>
            <form>
                <!-- Der View/Hide-Button verwendet type="button", um das Absenden zu verhindern -->
                <button id="button" type="button" onclick="changeType()" class="button">View</button>

                <!-- Das Eingabefeld für den Code -->
                <input type="password" id="inputField" name="code" placeholder="Enter your Code" required>

                <!-- Der Submit-Button sendet das Formular an den Server -->
                <button class="button" type="submit">CHECK CODE AND ADD TO CART</button>
            </form>
            <button id="orderBtn" style="display: none; margin-top: 20px;" class="snipcart-add-item button"
                data-item-id="" data-item-price="16.50"
                data-item-description="Stylish and comfortable embroidered beanie, available in multiple colors and sizes."
                data-item-image="" data-item-name="">
                ADD TO CART
            </button>
        </div>
    </div>

    <script>
        const form = document.getElementById("code-form");
        form.addEventListener("submit", async (event) => {
            event.preventDefault(); // Verhindert Standard-Formularabsendung

            const code = document.getElementById("inputField").value.trim();
            let lastChar = code[code.length - 1]

            if (!code) {
                alert("Bitte geben Sie einen gültigen Code ein.");
                return;
            }
            else if (lastChar != 1) {
                alert("The last digit of the code has to be 1.");
                return;
            }

            console.log("Sende Anfrage an /check1...");
            const response = await fetch("https://gamebackend-nfw1.onrender.com/check", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ code })
            });

            if (response.ok) {
                console.log("ok von server")
                const orderBtn = document.getElementById("orderBtn");
                const codeForm = document.getElementById("code-form");
                orderBtn.style.display = "block";
                codeForm.style.display = "none";
            } else {
                alert("Code could not be found on server.");
            }
        });
        document.addEventListener("DOMContentLoaded", () => {
            const colorSelect = document.getElementById("color-select");
            const slideshows = document.querySelectorAll(".slideshow");
            let currentSlideIndex = 0;

            // Standard: Schwarzes Produkt anzeigen
            document.getElementById("slideshow-black").style.display = "block";

            colorSelect.addEventListener("change", (event) => {
                const selectedColor = event.target.value;

                // Alle Slideshows ausblenden
                slideshows.forEach((slideshow) => {
                    slideshow.style.display = "none";
                });

                // Passende Slideshow anzeigen
                const activeSlideshow = document.getElementById(`slideshow-${selectedColor}`);
                if (activeSlideshow) {
                    activeSlideshow.style.display = "block";
                    resetSlides(activeSlideshow);
                }
            });

            // Funktion zum Wechseln der Bilder
            window.changeSlide = (direction) => {
                const activeSlideshow = document.querySelector(".slideshow[style='display: block;']");
                if (!activeSlideshow) return;

                const slides = activeSlideshow.querySelectorAll("img");
                slides[currentSlideIndex].classList.remove("active");

                currentSlideIndex = (currentSlideIndex + direction + slides.length) % slides.length;
                slides[currentSlideIndex].classList.add("active");
            };

            // Zurücksetzen der Slides
            function resetSlides(slideshow) {
                const slides = slideshow.querySelectorAll("img");
                slides.forEach((slide) => slide.classList.remove("active"));
                slides[0].classList.add("active"); // Setze erstes Bild aktiv
                currentSlideIndex = 0;
            }
        });
        function changeType() {
            var inputField = document.getElementById("inputField");
            var button = document.getElementById("button");

            // Ändere den Typ des Eingabefeldes zwischen "password" und "text"
            if (inputField.type === "password") {
                inputField.type = "text";
                button.textContent = "Hide";
            } else {
                inputField.type = "password";
                button.textContent = "View";
            }
        }
        function updateButtonAttributes() {
            const colorSelect = document.getElementById("color-select");
            const orderBtn = document.getElementById("orderBtn");

            const selectedColor = colorSelect.value;

            // Variant Mapping
            const variantMapping = {
                "black": 4657795253,
                "darkGreen": 4657795255,
                "navy": 323459,
                "white": 423456,
                "gray": 523456,
            };

            const variantId = variantMapping[`${selectedColor}`];

            // Bilder für Farben
            const imageMapping = {
                "black": "img/mütze/black/knit-beanie-black-front-67633795021ac.jpg",
                "darkGreen": "img/mütze/darkGreen/knit-beanie-dark-green-front-67633795026ad.jpg",
                "navy": "img/mütze/navy/knit-beanie-navy-front-6763379502605.jpg",
                "white": "img/mütze/white/knit-beanie-white-front-67633795027fd.jpg",
                "gray": "img/mütze/gray/knit-beanie-gray-front-6763379502765.jpg",
            };

            const selectedImage = imageMapping[selectedColor];

            if (variantId) {
                orderBtn.setAttribute("data-item-id", variantId);
                orderBtn.setAttribute("data-item-image", selectedImage);
                orderBtn.setAttribute("data-item-name", `Embroidered Beanie | ${selectedColor} | ${selectedSize}`);
                orderBtn.setAttribute("data-item-custom1-value", selectedColor); // Farbe
                orderBtn.setAttribute("data-item-custom2-value", selectedSize);  // Größe
                orderBtn.style.display = "block";
            } else {
                orderBtn.style.display = "none";
            }
        }

        // Event Listener hinzufügen
        document.getElementById("color-select").addEventListener("change", updateButtonAttributes);
        document.getElementById("size-select").addEventListener("change", updateButtonAttributes);

        // Initiale Attributaktualisierung
        updateButtonAttributes();
    </script>
</body>

</html>
